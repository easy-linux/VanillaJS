<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SimplePeer Manual Connect</title>
  <script src="https://unpkg.com/simple-peer@latest/simplepeer.min.js"></script>
  <style>
    textarea { width: 100%; height: 100px; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>SimplePeer - –°—Ç—Ä–∏–º–µ—Ä –∏ –í—å—é–≤–µ—Ä –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞</h1>

  <button id="startStreamer">–°—Ç–∞—Ä—Ç –°—Ç—Ä–∏–º–µ—Ä–∞ (–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä)</button>
  <button id="startViewer">–°—Ç–∞—Ä—Ç –í—å—é–≤–µ—Ä–∞ (–æ—Ç–≤–µ—Ç—á–∏–∫)</button>

  <h2>–í–∞—à —Å–∏–≥–Ω–∞–ª</h2>
  <textarea id="mySignal" readonly></textarea>

  <h2>–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Å–∏–≥–Ω–∞–ª –ø–∞—Ä—Ç–Ω–µ—Ä–∞</h2>
  <textarea id="partnerSignal"></textarea>
  <button id="connectToStream">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å—Ç—Ä–∏–º</button>
  <button id="connectToViewer">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–ª–∏–µ–Ω—Ç—É</button>

  <h2>–í–∏–¥–µ–æ –ø–æ—Ç–æ–∫</h2>
  <video id="video" autoplay playsinline muted style="width: 80%; background: black"></video>

  <script>
    let peerStream, peerClient;
    const mySignal = document.getElementById('mySignal');
    const partnerSignal = document.getElementById('partnerSignal');
    const video = document.getElementById('video');

    document.getElementById('startStreamer').onclick = async () => {
      const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false });

      peerStream = new SimplePeer({
        initiator: true,
        trickle: false,
        stream: stream
      });

      setupPeer(peerStream);
    };

    document.getElementById('startViewer').onclick = () => {
      peerClient = new SimplePeer({
        initiator: false,
        trickle: false
      });

      setupPeer(peerClient);
    };

    function setupPeer(peer) {
      peer.on('signal', data => {
        mySignal.value = JSON.stringify(data);
      });

      peer.on('connect', () => {
        console.log('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
      });

      peer.on('stream', remoteStream => {
        console.log('üìπ –ü–æ—Ç–æ–∫ –ø–æ–ª—É—á–µ–Ω');
        video.srcObject = remoteStream;
      });

      peer.on('error', err => {
        console.error('–û—à–∏–±–∫–∞:', err);
      });
    }

    document.getElementById('connectToStream').onclick = () => {
      const signal = JSON.parse(partnerSignal.value.trim());
      peerClient.signal(signal);
    };

    document.getElementById('connectToViewer').onclick = () => {
      const signal = JSON.parse(partnerSignal.value.trim());
      peerStream.signal(signal);
    };
  </script>
</body>
</html>